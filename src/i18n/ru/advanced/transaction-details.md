# Подробности транзакции

---

Транзакции Decred - это переводы DCR, которые происходят между блоками. Транзакции в основном состоят из входящих и исходящих данных, хотя имеют также некоторые другие участки данных.


## Формат транзакции 

Участок        | Описание                                                                                    | размер
---          | ---                                                                                            | ---
Version      | Версия транзакции. Эта цифра используется,чтобы указать, как следует интерпретировать транзакцию  | 4 байта
Input count  | Количество вводных данных транзакции, закодированное как целое число переменной длины                   | 1-9 байт
Inputs       | Сериализованный список всех вводных данных транзакции                                                | Переменная величина                                                      
Output count | Количество исходящих данных транзакции, закодированное как целое число переменной длины                  | 1-9 байт
Outputs      | Сериализованный список всех исходящих данных транзакции                                               | Variable
Lock time    | Время, когда транзакция может быть потрачена. (Обычно ноль, и в этом случае она не оказывает влияния)       | 4 байта
Expiry       | Высота блока, на которой истекает срок действия транзакции, и она более не действительна                       | 4 байта


### вводы
Inputs тратят ранее осуществленные outputs. Существует два типа inputs транзакций: Свидетель и не-свидетель.


#### Вводы - не-свидетели
Ввод non-witness-транзакции - это ссылка на неизрасходованный output и порядковый номер. Ссылка на неизрасходованный output называется outpoint. Outpoints имеют три участка:

Участок            | Описание                                                                                                                           | Размер
---              | ---                                                                                                                                   | ---
Transaction hash | Хеш транзакции, которая содержит тратящийся output                                                                     | 32 байт
Output index     | Индекс тратящегося output                                                                                                   | 4 байта
Tree             | В каком из деревьев находится тратящийся output. Это необходимо, потому что для поиска транзакций в блоке используется более одного дерева. | 1 байт

В дополнение к outpoint, non-witness inputs содержат порядковый номер. Это число имеет скорее историческое значение, нежели практическое применение; однако, наиболее актуальное его применение - включать "блокировку" платежей, чтобы они не могли быть изъяты до определенного времени.


#### Вводы свидетели
Ввод witness-транзакции содержит данные, необходимые для того, чтобы доказать, что output может быть потрачен. Вводы- свидетели содержат четыре участка данных:

Участок            | Описание
---              | ---
Value            | Количество монет, которое передает тратящийся output.
Block height     | Высота блока, содержащего транзакцию, в которой находится тратящийся output.
Block index      | Индекс транзакции, в которой находится тратящийся output.
Signature script | Скрипт, который удовлетворяет требованиям скрипта в тратящемся output. 


### Исходящие данные
Outputs - это переводы DCR, которые могут быть потрачены вводами (inputs). Outputs всегда имеют три участка данных:

Участок             | Описание                                                                                     | Размер
---               | ---                                                                                             | ---
Value             | Количество DCR, отправляемое выходами.                                                     | 8 байт
Version           | Версия выхода. Эта цифра используется, чтобы указать, как следует интерпретировать output. | 2 байта
Public key script | Скрипт, который должен быть удовлетворен, для того, чтобы потратить output                                           | Variable

---

## Сериализация 
Формат, показанный выше, не является тем форматом, в котором отправляются и принимаются транзакции. При отправке или получении транзакций данные могут быть сериализованы несколькими способами. Каким способом транзакция десериализуется, можно определить по ее версии. Версии транзакций занимают четыре байта, но эти четыре байта фактически используются для хранения двух отдельных значений. Первые два байта версии транзакции обозначают её фактический номер версии. Вторые два байта обозначают её формат сериализации.


### Serialization Formats
При сериализации имеются две основные части транзакции: ее "префикс" и его данные свидетеля.
Префикс транзакции состоит из:

* Inputs (без каких-либо witness data)
* Outputs
* Lock time
* Expiry

Witness data транзакции включают только ее inputs. Что включают в себя участки данных ее inputs, зависит от конкретного формата сериализации. Формат может быть любым из следующих:

* **0 (Full serialization)** - Префикс транзакции расположен непосредственно перед её witness data.
* **1 (No witness)** - Присутствует только префикс транзакции.
* **2 (Only witness)** - Witness data транзакции - единственные представленные данные. Для каждого input они включают его значение, высоту блока, индекс блока и скрипт подписи.
* **3 (Witness signing)** - Единственные имеющиеся данные - witness data, сериализуются для целей подписания. Для каждого input они включают только его скрипт подписи.
* **4 (Witness signing with value)** - Единственные имеющиеся данные - witness data,сериализуются для целей подписания. В отличие от Witness signing format, этот формат включает в себя значение каждого input перед его скриптом подписи.
