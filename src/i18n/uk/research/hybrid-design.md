# Гібридний дизайн 

---

Основною відмінністю від схеми follow-the-satoshi, описаної раніше [^1] є нова лотерейна система, в якій тікети треба спочатку придбати, а потім чекати протягом терміну "дозрівання" (maturity period) до того моменту, коли вони можуть бути вибрані та витрачені. Вибір тікетів для блоку виконується лексикографічно з пулу готових тікетів на основі псевдовипадковості, що міститься в заголовку блоку. Оскільки маніпуляція з цією псевдовипадкістю в системі PoW ускладнена, маніпуляція вибором тікета пов'язана з істотними витратами для PoW-майнера. Вибір тікетів за певний проміжок часу можна описати за допомогою функції щільності ймовірності (probability density function), подібної до ймовірності отримання блоку в PoW при постійній швидкості хешування за період часу при постійній складності [^ 2], що дає розподіл ймовірності в режимі, що приблизно дорівнює половині розміру тікет-пулу. Ціна покупки тікета регулюється новою складністю, яка визначається експоненційно середньозваженою кількістю куплених тікетів та розміром пулу готових тікетів у попередніх блоках.

Валідація блоків PoW може бути пояснена за допомогою наступних кроків::

1. 1.Блок запускається PoW-майнером, який вибирає транзакції для розташування у ньогму. Транзакції, пов'язані з системою ставок (stake system), розміщені у UTXO set.
2. POS-майнери голосують по блоку, виконуючи vote-транзакцію за своїми тікетами. Vote дозволяє як блоку бути побудованим зверху попереднього блоку, так і визначає, чи є дійсним попереднє регулярне дерево транзакцій (що містить койнбазу та транзакції, не пов'язані зі stake).
3. Ще один PoW-майнер починає створювати блок, включаючи голоси (votes) PoS-майнерів. Більшість поданих голосів мають бути включені в наступний блок для того, щоб цей блок був прийнятий мережею. За vote-транзакціями в цьому новому блоці PoW-майнер перевіряє прапорець, щоби дізнатися, чи вказав PoS-майнер, що регулярне дерево транзакцій було діючим. Ці прапори голосування підраховуються, і на основі більшості голосів в цьому блоці встановлюється біт-прапор, який вказує на валідність дерева транзакцій попереднього блоку.
4. Знаходится nonce, який задовольняє складність мережі, і блок вставляється в blockchain. Якщо регулярне дерево транзакцій попереднього блоку було діючим, вставляє ці транзакції в UTXO set. Переходіть до пункту 1.

Щоб перешкодити маніпуляціям зі включеними голосами, для поточного блоку застосовується штраф лінійної субсидії (linear subsidy penalty), якщо вони не можуть включити в свій блок всі vote-транзакції. "Програмне" покарання, відмова визнати попереднє дерево транзакцій дійсним, допомагає попередити погіршення роботи, необхідної для забезпечення безпеки системи, і робить припущення, що наступний блок буде отриманий майнером, який не буде зацікавлений в збереженні субсидії попереднього блоку на користь своїх власних. Навіть у випадку, якщо це невірно, зловмисник з високим рівнем хешування так само буде потребувати, як мінімум, \((\text{number for majority}/2)+1\) голосів на користь дерева транзакцій свого попереднього блоку, щоб створити блок, який надасть їм яку-небудь субсидію від попереднього блоку.

Біт-прапори чітко та ясно додаються як заголовку блоку, так і до votes, щоб майнер міг легко проголосувати у нових, як hard, так и soft форках.

---

## <i class="fa fa-book"></i> Посилання 

[^1]: Bentov I., Lee C., Mizrahi A., Rosenfeld M. 2014. [Proof-of-activity: Extending Bitcoin's proof-of-work via proof-of-stake](https://decred.org/research/bentov2014.pdf).
[^2]: Nakamoto S. 2008. [Bitcoin: A peer-to-peer electronic cash system](https://decred.org/research/nakamoto2008.pdf).
